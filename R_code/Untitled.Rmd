---
title: "dummy"
author: "Sebastian Sauer"
date: "21 Juli 2016"
output: html_document
---

---
title: "BiPOCD_Modeling_2"
author: "Sebastian Sauer"
date: "21 Juli 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, warning = FALSE, message = FALSE)

library(pscl)  # pseudo R^2
library(magrittr) # piping
library(mice)  # imputation
library(readr) # csv import
library(knitr) # rmarkdown
library(tidyr) # tibbling objects
library(caret) # modeling
library(ggplot2) # plotting
library(tibble) # tibble
library(dplyr) # data wrangling


# variables
mod_results <- list()



# overhead
write_to_file <- FALSE
```



```{r read_data}
data_class <- read_csv("data_class.csv")
data_class$responder_3m_f <- factor(data_class$responder_3m_f)
str(data_class$responder_3m_f)
cat("TEST")
getwd()
```




```{r function_write_model_results}

save_model_results <- function(obj,
                               predict_results = TRUE,
                               report_varimp = TRUE){

  results <- list()

  results$fit <- obj
  results$name <- deparse(substitute(obj))


  if (predict_results == TRUE){
    fit_pred <- predict(obj, test)
    results$prediction_results <- fit_pred
    results$confusion_matrix <- confusionMatrix(data = fit_pred, test$responder_3m_f)
  }

  if (report_varimp == TRUE){
    results$varimp <- varImp(obj, scale = FALSE)
  }

  return(results)
}

```



# classification (dichotomous)

As we have two outcomes, one dichotomous and one metric, we can both do classification and regression. Let's look at classification first.


Before I forget: we need to exclude the metric outcome variable `CYBOCS_3m`.

```{r data_class_train_test}

set.seed(42)
trainIndex <- createDataPartition(data_class$responder_3m_f, p = .8,
                                  list = FALSE,
                                  times = 1)

train <- data_class[trainIndex, ]
test <- data_class[-trainIndex, ]

cat("Class of DV:\n")
str(data_class$responder_3m_f)
str(train$responder_3m_f)
str(test$responder_3m_f)


```



## LM

Let's fit a linear logistic model. The model showed some problems with factor variables that have sparsely populated levels. Additionally, the ratio of variables to observations is not really nice. We probably will not arrive anywhere with this model.


